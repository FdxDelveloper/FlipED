import React, {Component} from "react"

import ChatInterface from "./ChatInterface"

const TYPING_TIME = 1300

const stage = [{
  route: {
    0: [{
      user: 2,
      text: [
        "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö N' ‡∏†‡∏π‡∏°‡∏¥ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡∏ô‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ üòÄ",
        "‡∏£‡∏π‡πâ‡∏£‡∏∂‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ <b>‡πÄ‡∏™‡∏µ‡πà‡∏¢‡πÇ‡∏≠</b> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£?",
      ]
    }, {
      user: 1,
      text: ["‡∏≠‡πà‡∏≤‡∏´‡∏∞..."]
    }]
  },
  choices: ["‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå üòÄ", "‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ß 112 üëã"]
}, {
  route: {
    0: {
      user: 2,
      text: [
        `‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô ‡∏ú‡∏°‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏ù‡∏£‡∏±‡πà‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á
          (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πà ‡∏û‡∏¥‡∏•‡∏∂‡∏Å‡∏î‡∏µ ‡∏ú‡∏°‡∏°‡∏µ‡∏ô‡∏±‡∏î‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ô‡πÄ‡∏™‡∏°‡∏≠‡πÜ ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏µ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô)`,
        `‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏∂‡∏á‡∏ñ‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ <b>‡πÄ‡∏™‡∏µ‡πà‡∏¢‡πÇ‡∏≠</b> ‡∏ô‡∏µ‡πà‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏Ñ‡∏¥‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£`
      ]
    },
    1: {
      user: 2,
      text: [`‡πÇ‡∏≠‡πä‡∏¢‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏∂‡∏á‡∏Å‡πá‡πÇ‡∏î‡∏ô‡∏à‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏´‡∏µ‡πâ‡∏¢‡πÑ‡∏£ üòÇ üòÇ üòÇ`]
    }
  },
  choices: ["‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏û‡∏≠‡∏à‡∏∞‡∏ó‡∏£‡∏≤‡∏ö‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö üòÄ"]
}, {
  route: [{
    user: 2,
    text: [
      `‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏Ñ‡∏¥‡∏î ‡∏ú‡∏°‡∏ö‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£ ‡∏ú‡∏°‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ú‡∏°‡∏û‡∏≠‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ`,
      `‡∏ú‡∏°‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤ ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <b>‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏®‡∏ß‡∏£‡∏£‡∏© 2520</b> ‡∏Ñ‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏≤‡∏ß<b>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏õ‡∏µ 2526-2527</b>`
    ]
  }],
  choices: ["‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏•‡πà‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö"]
}, {
  route: {
    0: [{
      user: 2,
      text: [
        `‡∏ó‡∏≥‡πÑ‡∏°‡∏ú‡∏°‡∏à‡∏∂‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡πà‡∏ô‡∏ô‡∏±‡πâ‡∏ô? ‡∏ú‡∏°‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏õ‡∏µ 2526
          ‡∏ú‡∏°‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ ‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏ó‡∏¢ <b>‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô</b>`,
        `‡∏≠‡∏µ‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ñ‡πâ‡∏≤‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô‡∏ä‡∏∑‡πà‡∏≠ <b>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ 9 ‡∏£‡∏±‡∏ä‡∏Å‡∏≤‡∏•</b>
          (‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ß‡πÜ
          <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏¢‡πà‡∏≠‡∏°‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ô‡πâ‡∏≥ ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ü‡πâ‡∏≤‡πÄ‡∏™‡∏°‡∏≠</b>)`,
        `‡∏ã‡∏∂‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÉ‡∏ô‡∏õ‡∏µ 2525 <b>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡πà‡∏¢‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ</b> ‡∏ã‡∏∂‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏±‡πâ‡∏ô
          ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏≠‡πà‡∏¢‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏á`,
      ]
    }, {
      user: 2,
      text: [
        `‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ú‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <b>‡πÉ‡∏ô‡∏õ‡∏µ 2528 ‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</b>
          ‡∏¢‡∏±‡∏á‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ ‡∏ï‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏á‡∏á‡∏°‡∏≤‡∏Å ‡∏ß‡πà‡∏≤ <b>"‡πÄ‡∏™‡∏µ‡πà‡∏¢" ‡πÑ‡∏´‡∏ô?</b>`,
        `‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡πÑ‡∏°‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á <b>"‡πÄ‡∏™‡∏µ‡πà‡∏¢‡πÇ‡∏≠"</b>? ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á`
      ]
    }]
  },
  choices: [`‡πÄ‡∏•‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡πÄ‡∏•‡∏¢‡∏ã‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö üëã`]
}, {
  route: [[{
    user: 2,
    text: [
      `‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡πà ‡∏ú‡∏°‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏∞‡∏î‡∏π‡∏ß‡πà‡∏≤ ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏®‡∏ß‡∏£‡∏£‡∏© 2520
        ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤`,
      `‡∏Å‡πá‡∏û‡∏ö‡∏ß‡πà‡∏≤ ‡∏õ‡∏µ 2522 ‡∏Ñ‡∏∏‡∏ì <b>"‡∏¢‡∏∏‡∏ß‡∏ò‡∏¥‡∏î‡∏≤ ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê"</b>
        (‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏∏‡∏ì <b>"‡∏™‡∏∏‡∏à‡∏≤‡∏£‡∏¥‡∏ì‡∏µ ‡∏ß‡∏¥‡∏ß‡∏±‡∏ä‡∏£‡∏ß‡∏á‡∏®‡πå"</b> ‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) ‡πÄ‡∏£‡∏¥‡πà‡∏° <b>"‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ß‡∏á‡∏Å‡∏≤‡∏£"</b>`,
    ]
  }, {
    user: 2,
    text: [
      `‡∏ú‡∏°‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πà‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô<b>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á</b>‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô (contribute)
        ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏≤‡∏î‡∏û‡∏¥‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡πÇ‡∏≠"`,
      `‡∏Ñ‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∏‡∏ß‡∏ò‡∏¥‡∏î‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å "‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ß‡∏á‡∏Å‡∏≤‡∏£"
        ‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô<b>‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡∏∑‡∏≠‡∏ã‡∏∏‡∏ö‡∏ã‡∏¥‡∏ö‡πÅ‡∏û‡∏£‡πà‡∏´‡∏•‡∏≤‡∏¢</b>‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà`,
      `‡πÅ‡∏•‡∏∞‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°<b>‡∏û‡∏π‡∏î‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö‡∏ï‡πà‡∏≠ "‡πÄ‡∏™‡∏µ‡πà‡∏¢"</b> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏û‡∏£‡πà‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà
        ‡∏Å‡πá‡∏ô‡πà‡∏≤‡∏à‡∏∞<b>‡∏£‡∏≤‡∏ß‡πÜ 2-3 ‡∏õ‡∏µ</b>`,
      `‡∏Å‡πá‡∏à‡∏∞‡∏ï‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì<b>‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏®‡∏ß‡∏£‡∏£‡∏© 2525</b>`,
      `‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏Ñ‡∏≤‡∏î‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ
        (<b>2526-2527</b> ‡∏ó‡∏µ‡πà‡∏ú‡∏°‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å) ‡∏Å‡πá‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á`
    ]
  }]],
  choices: ["‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö üëã"]
}]

const users = [{
  name: "Somsak Bear",
  avatar: "/images/icon/listening.svg",
}, {
  name: "Pmc",
  client: 1
}, {
  name: "Somsak Jeamteerasakul",
  avatar: "https://scontent.fbkk1-2.fna.fbcdn.net/v/t1.0-1/12063386_889937894392824_5154552084527806469_n.jpg?oh=e8d5ecececfce77f8f29b7551987a8f4&oe=58B03653"
}]

class ChatStage extends Component {

  constructor(props) {
    super(props)
    this.state = {
      iter: 0,
      backlog: [],
      isTyping: {}
    }
    stage[0].route[0].forEach(chat => {
      chat.text.forEach((text, index) => {
        this.addChat(text, index, chat.user)
      })
    })
  }

  handleChoiceSelection = i => {
    this.addChat(stage[this.state.iter].choices[i], 0, 1)

    if (typeof stage[this.state.iter + 1].route[i] !== "undefined") {
      const seq = stage[this.state.iter + 1].route[i]
      if (seq.constructor === Array) {
        let counter = 0
        seq.forEach(item => {
          item.text.forEach(text => {
            this.addWithAnim(text, counter, item.user)
            counter++
          })
        })
      } else if (typeof seq === "object") {
        seq.text.forEach((text, index) => {
          this.addWithAnim(text, index, seq.user)
        })
      }
    } else {
      this.addWithAnim({
        user: 1,
        text: ["Route is not defined! Exiting."]
      })
    }

    this.setState({iter: this.state.iter + 1})
  }

  addChat = (text, index, user) => {
    const backlog = this.state.backlog
    backlog.push({
      text,
      user,
      showAvatar: !index || user !== backlog[backlog.length - 1].user
    })
    this.setState({backlog})
  }

  toggleTyping = (index = this.state.backlog.length, state) => this.setState({
    isTyping: Object.assign({}, this.state.isTyping, {
      [index]: state || !this.state.isTyping[index]
    })
  })

  addWithAnim = (text, index, user) => {
    setTimeout(() => {
      this.addChat(text, index, user)
      this.toggleTyping()
      setTimeout(() => {
        this.toggleTyping()
      }, (TYPING_TIME + 3000))
    }, TYPING_TIME * index)
  }

  render = () => (
    <ChatInterface
      backlog={this.state.backlog}
      user={users}
      choices={stage[this.state.iter].choices}
      onChoiceSelected={this.handleChoiceSelection}
      typing={this.state.isTyping}
      setTyping={index => this.toggleTyping(index)}
    />
  )

}

export default ChatStage
